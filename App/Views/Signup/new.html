{% extends "base.html" %} {% block title %}Register{% endblock %} {% block
footer %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("signup-form");
    const passwordInput = document.getElementById("inputPassword");
    const passwordError = document.getElementById("password-error");
    const passwordSuccess = document.getElementById("password-success");
    const passwordInputRepeat = document.getElementById("inputPasswordRepeat");
    const passwordRepeatError = document.getElementById(
      "password_repeat-error"
    );
    const passwordRepeatSuccess = document.getElementById(
      "password_repeat-success"
    );

    function validatePassword(password) {
      const minLength = 8;
      const hasLetter = /[a-zA-Z]/.test(password);
      const hasNumber = /\d/.test(password);
      const hasSymbol = /[!@#$%^&*(),.?":{}|<>]/.test(password);

      let errors = [];

      if (password.length < minLength) {
        errors.push(`at least ${minLength} characters`);
      }
      if (!hasLetter) {
        errors.push("at least one letter");
      }
      if (!hasNumber) {
        errors.push("at least one number");
      }
      if (!hasSymbol) {
        errors.push("at least one symbol");
      }

      return errors;
    }

    function validateRepeatPassword(repeatPassword) {
      const password = passwordInput.value;

      if (password !== repeatPassword) {
        return false;
      }
      return true;
    }

    passwordInput.addEventListener("input", function () {
      const password = passwordInput.value;
      const errors = validatePassword(password);

      if (errors.length > 0) {
        passwordError.textContent =
          "ðŸ›‘ Password must contain " + errors.join(", ") + ".";
        passwordError.className = "error";
      } else {
        passwordError.textContent = "";
        passwordSuccess.textContent = "âœ… Password looks good!";
        passwordError.className = "success";
      }
    });

    passwordInputRepeat.addEventListener("input", function () {
      const repeatPassword = passwordInputRepeat.value;
      const repeatError = validateRepeatPassword(repeatPassword);
      if (!repeatError) {
        passwordRepeatError.textContent = "ðŸ›‘ Passwords do not match!";
      } else {
        passwordRepeatError.textContent = "";
        passwordRepeatSuccess.textContent = "âœ… Passwords match!";
        passwordError.className = "success";
      }
    });

    form.addEventListener("submit", function (e) {
      const password = passwordInput.value;
      // const repeat = repeatInput.value;
      const errors = validatePassword(password);

      if (errors.length > 0) {
        e.preventDefault();
        let message = "ðŸ›‘ Fix password before submitting!";

        passwordError.textContent = message;
        passwordError.className = "error";
      }
    });
  });
</script>

{% endblock %} {% block body %}

<h1>Registration page</h1>

{% if user.errors is not empty %}
<p>Errors:</p>
<ul>
  {% for error in user.errors %}
  <li>{{ error }}</li>
  {% endfor %}
</ul>

{% endif %}

<form method="POST" action="/signup/create" id="signup-form">
  <div>
    <label for="inputName">Name</label>
    <input
      type="text"
      id="inputName"
      placeholder="Name"
      name="name"
      value="{{ user.name }}"
      autofocus
      required
    />
  </div>
  <div>
    <label for="inputEmail">Email address</label>
    <input
      type="email"
      id="inputEmail"
      placeholder="Email address"
      name="email"
      value="{{ user.email }}"
      autofocus
      required
    />
  </div>
  <div>
    <label for="inputPassword">Password</label>
    <input
      type="password"
      id="inputPassword"
      placeholder="Password"
      name="password"
      autofocus
    />
  </div>
  <div id="password-success" class="error" style="color: green"></div>
  <div id="password-error" class="error" style="color: red"></div>

  <div>
    <label for="inputPasswordRepeat">Repeat Password</label>
    <input
      type="password"
      id="inputPasswordRepeat"
      placeholder="Repeat password"
      name="repeat_password"
      autofocus
    />
  </div>
  <div id="password_repeat-success" class="error" style="color: green"></div>
  <div id="password_repeat-error" class="error" style="color: red"></div>

  <button type="submit">Sign Up</button>
</form>

{% endblock %}
